Ты — старший full-stack разработчик и архитектор, который должен спроектировать и частично реализовать полноценный веб-сервис-помощник по выбору лотерей Столото в формате сайта с интегрированным чат-ботом.
Твоя задача — на основе открытых данных Stoloto и предпочтений пользователя построить систему персонализированных рекомендаций лотерей и интерфейс общения с пользователем в виде чат-бота на веб-странице.

Context (контекст задачи)

В приложенном документе описана задача: создать умного помощника по выбору лотерей, который:

собирает и анализирует открытые данные о лотереях (правила, вероятность выигрыша, стоимость, частота розыгрышей, размеры призов, статистика архивных тиражей);

спрашивает у пользователя его предпочтения (бюджет, желаемый тип выигрыша — мгновенный/тиражный, допустимое ожидание, важность вероятности vs размера выигрыша, приемлемый диапазон цен, частота игры и т.д.);

формирует персонализированный, ранжированный список подходящих лотерей и объясняет рекомендации простым языком.

Формат решения:

Полноценный веб-сайт (не только чат-окно), с:

главной страницей;

страницей/виджетом чат-бота;

личным кабинетом пользователя с авторизацией/регистрацией;

страницей аналитики/статистики по лотереям.

Чат-бот встроен прямо в сайт (а не в Telegram/VK и т.п.).

Источники данных для парсинга (Stoloto):

Текущие лотереи:

https://www.stoloto.ru/sitemap_main.xml

https://www.stoloto.ru/

Архивы для расчёта вероятностей и статистики:

https://www.stoloto.ru/sitemap_archive.xml

Технологический стек (обязателен):

Backend: Python + Flask.

База данных: PostgreSQL.

Frontend: можно выбрать на своё усмотрение (например, чистый HTML/CSS/JS или React/Vue), главное — реализовать понятный UI и интеграцию с Flask API.

LLM: локальная (self-hosted) open-source модель, без обращения к проприетарным внешним API (вроде OpenAI, закрытых облачных сервисов и т.п.).

Дизайн:

Общий визуальный стиль должен быть похож на дизайн сайта Stoloto:

яркие фоны (красный/оранжевый),

белые блоки с закруглёнными углами,

акцентные фиолетовые/жёлтые элементы,

крупные заголовки, понятная типографика, четкие CTA-кнопки.

Instructions (что нужно от модели)

Архитектура решения

Опиши модульную архитектуру приложения, включающую:

Модуль парсинга данных Stoloto (sitemap_main, sitemap_archive + нужные страницы лотерей).

Слой сохранения и обновления данных в PostgreSQL (схема БД: таблицы лотерей, тиражей, категорий выигрышей, пользовательских профилей, пользовательской статистики, истории диалогов и рекомендаций).

Модуль аналитики/расчёта статистики по архиву тиражей:

частота выпадения выигрышей по категориям;

оценка вероятностей выигрыша и примерного ожидаемого выигрыша;

метрики для визуализации (графики, средний выигрыш, частота джекпотов и т.д.).

Рекомендательный модуль:

сопоставляет предпочтения пользователя (из анкеты и/или диалога с чат-ботом) с параметрами лотерей;

формирует персонализированный ранжированный список лотерей с объяснением, почему каждая позиция рекомендована.

Модуль локальной LLM:

загрузка и инициализация локальной модели;

подготовка контекста на основе данных из БД (описания лотерей, статистика, предпочтения и история пользователя);

генерация ответов чат-бота.

Веб-интерфейс (Flask + шаблоны и/или SPA):

чат-окно;

анкета предпочтений пользователя для первичной настройки профиля;

личный кабинет с просмотром истории игр, рекомендаций и статистики;

страницы с визуализацией аналитики по лотереям.

Парсинг данных Stoloto

Сгенерируй пример кода на Python (Flask/отдельный скрипт) с использованием открытых библиотек (requests, httpx, BeautifulSoup/lxml и т.п.), который:

скачивает и парсит sitemap_main.xml и sitemap_archive.xml;

извлекает ссылки на страницы лотерей и архивов тиражей;

ходит по этим страницам и собирает данные: название лотереи, тип (мгновенная/тиражная), стоимость билета, частота розыгрышей, правила, размер и категории призов, результаты тиражей (дата, комбинация, распределение призов и т.д.);

складывает всё в таблицы PostgreSQL.

Предусмотри возможность периодического обновления данных (например, через простую CLI-команду или фоновый job).

Схема БД PostgreSQL

Спроектируй и опиши SQL-схему (DDL) для PostgreSQL, включающую минимум:

lotteries — параметры лотерей;

draws — тиражи и результаты;

prize_categories — категории выигрышей;

users — учётные записи;

user_preferences — сохранённые ответы пользователя (бюджет, тип выигрыша, ожидание, риск-профиль и др. фильтры из PDF);

user_stats — агрегированная статистика по играм/выигрышам пользователя;

recommendations — история выданных рекомендаций;

chat_history — история диалогов с чат-ботом.

Приведи SQL-код для создания таблиц.

Рекомендательный алгоритм

Ориентируясь на требования из документа, опиши и реализуй (на уровне псевдокода или Python-функций) алгоритм, который:

нормализует и интерпретирует ответы пользователя (бюджет, желаемая частота выигрышей, важность размера джекпота, готовность ждать тираж, минимально приемлемая вероятность выигрыша и т.п.);

сопоставляет их с параметрами лотерей из БД;

рассчитывает скоринг/рейтинг лотерей (например, взвешенная сумма по критериям) и сортирует список;

формирует объяснение рекомендаций человеческим языком (“Лотерея X, потому что розыгрыш каждый день, стоимость билета в вашем бюджете и высокая вероятность небольшого выигрыша”).

Интеграция локальной LLM-модели

Выбери и предложи одну конкретную open-source LLM-модель (например, на базе LLaMA/Mistral и т.п.), которую можно запустить локально на CPU/GPU.

Покажи пример кода на Python для:

установки/загрузки модели (через transformers, llama.cpp, ctransformers, vllm или другие открытые решения);

инициализации пайплайна генерации текста;

написания обёртки, которая принимает:

текст вопроса пользователя,

извлечённые из БД данные по релевантным лотереям и предпочтениям пользователя,

краткий системный промт с правилом “отвечать только на основе переданных данных, если данных нет — честно говорить, что информации недостаточно”;

возвращает финальный ответ чат-бота.

Обязательно добавь пример интеграции этой обёртки во Flask-маршрут /api/chat, который:

принимает сообщение пользователя (и токен/ID пользователя для учёта его профиля);

подтягивает его данные и статистику из PostgreSQL;

формирует контекст и вызывает локальную LLM;

сохраняет ответ в chat_history и возвращает его на фронтенд.

Сгенерируй минимальный пример скрипта запуска модели (CLI/app.py), с указанием:

требований (requirements.txt);

примера команды запуска.

Веб-интерфейс и UX

Опиши структуру страниц и сгенерируй пример шаблонов (HTML + CSS/JS или React-компоненты), включая:

главную страницу с кратким описанием сервиса и CTA “Начать подбор лотерей” / “Открыть чат-помощника”;

страницу/виджет чат-бота с:

историей сообщений,

формой ввода,

возможностью подсказок-кнопок (“Подобрать лотерею”, “Показать статистику”, “Изменить мои предпочтения”);

страницу личного кабинета:

блок с сохранёнными предпочтениями и возможностью их менять;

историю игр/рекомендаций;

простые визуализации (графики/таблицы) по статистике пользователя;

страницу/секцию аналитики по лотереям:

таблица/карточки лотерей;

визуализация ключевых метрик (частота джекпотов, средний выигрыш, вероятность выигрыша по категориям).

В целом архитектура фронтона сайта должна выглядеть так: 

Главный экран до регистрации:
1. Твой помощник в выборе лотереи
2. Статистика о лотереях в цифрах (сводная аналитика)
3. Кнопка зарегестрироваться (текст: узнать, какие лотереи мне подходят)

Регистрация:
1. Почта
2. Пароль
3. Опрос (отдельный от чата):
    1. Бюджет для участия 
    2. Тип выигрыша
    3. Величина приза
    4. Доступная вероятность

Главный экран после регистрации:
1. Твой помощник в выборе лотереи
2. Статистика о лотереях в цифрах (сводная аналитика)
3. Большая кнопка чата с помощником
4. Список подходящих лотерей
5. Указать свои предпочтения 

Экран со всеми спаршенными лотереями и их статистикой:
1. Список всех лотерей
2. Статистика по каждой лотерее

Рядом с каждой лотереей подписать каков шанс выигрыша 


Стиль — минималистичный дизайн в черно-желтом стиле, свечение под мышкой на фоне как на сайтах крупных айти компаний, в целом дизайн должен быть очень понятным для пользователя, как в крупных айти компаниях, на сайте должны быть плавные анимации, сообщения в чат боте должны появляться с анимацией загрузки. Используй все современные приемы для ui-ux дизайна.

API и безопасность

Опиши REST/JSON API между фронтендом и Flask-backend’ом:

/api/auth/register, /api/auth/login, /api/auth/me;

/api/preferences (CRUD);

/api/chat;

/api/lotteries, /api/lotteries/<id>;

/api/analytics/....

Добавь базовую аутентификацию (JWT/Flask-Login) и простую защиту от очевидных проблем (rate limit на чат, проверка входных данных).

Инструкция по запуску проекта

Сформируй подробный README-план:

установка зависимостей;

настройка PostgreSQL (создание БД и таблиц);

запуск скрипта парсинга и заполнения БД;

запуск локальной LLM;

запуск Flask-сервера и фронтенда;

пример команд и последовательность действий.

Constraints (ограничения)

Используй только открытые и свободные технологии и модели.

Не используй платные/закрытые API или проприетарные облачные LLM.

Формат решения — веб-приложение с собственным интерфейсом (никаких Telegram/VK-ботов).

Код и объяснения должны быть достаточно подробными, чтобы по ним можно было запустить рабочий прототип локально (на одной машине).

При отсутствии данных или невозможности точно посчитать вероятность — явно пиши, какие есть допущения и ограничения.

Output Format (формат ответа модели)

Пожалуйста, выдай ответ в следующей структуре:

Архитектура и стек (краткая схема модулей + стек технологий).

Схема БД и SQL-DDL.

Парсинг и загрузка данных (код/псевдокод + пояснения).

Алгоритм рекомендаций (описание + Python-пример).

Интеграция локальной LLM (выбор модели, код запуска, пример Flask-маршрута).

Страницы сайта и UI (описание + ключевые фрагменты шаблонов/компонентов).

API-контракты (список маршрутов и форматов запросов/ответов).

Инструкция по запуску (по шагам).


Важно! Для чат бота используй https://ollama.com/ и документацию: https://docs.ollama.com/
Олама уже локально скачана на мой компьютер